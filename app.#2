$NOMOD51	 ;to suppress the pre-defined addresses by keil
$include (C8051F020.INC)		; to declare the device peripherals	with it's addresses
ORG 0H					   ; to start writing the code from the base 0


;diable the watch dog
MOV WDTCN,#11011110B ;0DEH
MOV WDTCN,#10101101B ;0ADH

; config of clock
MOV OSCICN , #14H ; 2MH clock
;config cross bar
MOV XBR0 , #00H
MOV XBR1 , #00H
MOV XBR2 , #040H  ; Cross bar enabled , weak Pull-up enabled 

;config,setup
PB1 BIT P0.0
PB2 BIT P0.1
START BIT P0.2
SETB PB1
SETB PB2
SETB START
MOV 61H, #05H
MOV R4, #00H	;Max 1's digit
MOV R6, #00H 	;Max 10's digit
MOV DPTR, #400H  
MOV P0MDOUT, #00h
MOV P1MDOUT, #11111110B
MOV P2MDOUT, #11111111B
MOV R3, #01h
	
SETUP: 
	MOV A, R4
	MOVC A, @A+DPTR
	MOV P1, A
	MOV A, R6
	MOVC A, @A+DPTR
	MOV P2, A
	MOV 30H,R6
	MOV 31H, R4
JNB START,MAIN

JNB PB1,INCREMENT1S
JNB PB2,INCREMENT10S

AJMP SETUP

MEM:
	MOV R6, 30H
	JB P0.3,FREQ0
	JB P0.4,FREQ1
	JB P0.5,FREQ2
	FREQS:
	MOV DPTR,#50FH
	MOVC A,@A+DPTR
	MOV 61H,A
	AJMP MAX
	FREQ0:
		MOV A ,#00H
		AJMP FREQS
	FREQ1:
		MOV A ,#01H
		AJMP FREQS
	FREQ2:
		MOV A ,#02H
		AJMP FREQS
INCREMENT1S:
	CJNE R4, #0AH, IN1
	MOV R4,#00H
	ACALL DELAY
	AJMP SETUP
	IN1:INC R4
	ACALL DELAY
	AJMP SETUP
	
INCREMENT10S:
	CJNE R6,#0AH,IN2
	MOV R6,#00H
	ACALL DELAY
	AJMP SETUP
	IN2:INC R6
	ACALL DELAY
	AJMP SETUP
		
LEDON:
	CJNE R3,#0h,LEDOFF
	MOV R3, #01h
	CLR P1.7
	SETB P2.7
	AJMP MEM

LEDOFF:
	MOV R3, #0h
	CLR P2.7
	SETB P1.7
	AJMP MEM

LOOP10:
	MOV R4, #0Ah
	AJMP LOOP20

MAX:
	MOV DPTR, #400h
	CLR A
	ADD A, R6
    MOVC A, @A+DPTR
    MOV P2, A
	MOV R4, 31H
  	LOOP20:
    	CLR A
		ADD A, R4
    	MOVC A, @A+DPTR
    	MOV P1, A

    	ACALL DELAY
    	DEC R4

		CJNE R4, #0h, LOOP20
		DEC R6

		CLR A
		ADD A, R6
		MOVC A, @A+DPTR
		MOV P2, A

		CJNE R6, #0h, LOOP10
		AJMP LEDON

MAIN:
CJNE R6,#0h,MAX



DELAY :
	MOV R2,61H
	LOOP3:MOV R1,#200
	LOOP2:MOV R0,#198

	LOOP1:
	DJNZ R0,LOOP1

	DJNZ R1,LOOP2
	DJNZ R2,LOOP3
	RET

ORG 401H
DB 3FH,06H,5BH,4FH,66H,6DH,7DH,07H,7FH,6FH
ORG 50FH
DB 05H, 0AH, 014H 
END